# EVRAZ AI metallurgy hackathon
Продуйте металл через Data Science
---
29-31 October 2021                                                                 https://hackathon.evraz.com

![logo](img/logo.png)

### Задача - разработать алгоритм предсказания содержание углерода и температуру чугуна.

В этой задаче две подзадачи:
- Реализовать алгоритм, предсказывающий содержание углерода и температуры чугуна на момент конца плавки металла
- Задача из реального мира – придумать как обобщить алгоритм из пункта 1 на ситуацию реального производства. В реальном времени мы не знаем, когда наступит конец продувки, а должны определить это сами на основании прогнозируемых параметров чугуна. Что нужно добавить? Как перейти от модельной задачи к задаче из реального мира? Как развить алгоритм так, чтобы это было максимально полезно бизнесу?

[Подробное описание](https://russianhackers.notion.site/1-Data-Science-4cc89ba42de1429bbac316f59bf07a3b)

## Контекст
```При производстве стали чугун "продувается" кислородом для удаления примесей. Этот процесс идёт в среднем 15-25 минут при температуре около 1600 градусов. За процессом следит машинист дистрибутора, который на основе своего опыта и специальных знаний определяет момент, когда процесс продувки нужно остановить. В процессе продувки металл насыщается кислородом, а его температура увеличивается. Если "передуть" чугун – сгорит больше металла и на выходе будет меньше стали, что приведет к потере прибыли, если "недодуть", то марка стали не будет удовлетворять заданным критериям и нужно будет "додувать", что замедляет производительность цеха.```

```Вам предстоит разработать алгоритм прогнозирования параметров чугуна – что может стать отличным помощником для машиниста и существенно улучшить производство ЕВРАЗа```

## Структура репозитория

- **baseline** - папка для baseline решения
- **eda** - разведочный анализ данных
- **lama** - решение на основе LightAutoML
- **submits** - папка для хранения сабмитов (csv-файл + ноутбук/py-файл в zip-архиве)

## Исходные данные
В рамках этой задачи вам будут даны данные о продувки чугуна в цехе:
- **produv** – Таблица содержит основные параметры продувки - мгновенный расход кислорода и положение (наклон) фурмы
- **lom** – Вместе с чугуном в фурму засыпают лом - это часть технологического процесса. Таблица содержит вес и тип ломов, использованных в каждой плавке
- **plavki** – Основная информация по плавке - характеристики плавки (марка металла, направление разливки) и оборудования
- **sip** – Сыпучие добавки, используемые в технологическом процессе
- **chronom** – хронометраж - время начала и конца различных операций во время плавки
- **chugun** – Химический состав и характеристики чугуна
- **gas** – Информация об анализе отходящих газов
- **target** – целевые значения

[Атрибутный состав данных](https://www.notion.so/a685453e4fde41a098d9ad704d906e21)

## Что сделано
- мёрдж данных
- агрегация и создание признаков
- Построение схемы кросс-валидации
- LightGBM, XGBoost
- Регуляризация (количеством деревьев)
- Отбор признаков

## Потрачено времени
- 32 часа по собственным подсчётам за перид времени с 18:00 пятницы 29 октября до 09:00 воскресенья 31 октября.
- WakaTime утверждает что было потрачено 39 ч 25 мин.

## Lesson learned (что можно было сделать ещё)
- наибольший скор дали **переобученные** неглубокие модели. Вопрос, как распознать такие случаи?
- логарифмировть скошеное распределение таргета - попробовал после окончания в песочниуе. Метрика выросла на 0,024!!!
- модели обучать можно не только последоватьельно (сначала температуру, а потом углерод), но и
  - температуру предсказывать с углеродом и наоборот
  - по 2 раза - сначала без углерода и температуры, а потом прогноз с ними
- LightAutML в режиме CatBoost+Optuna
- стекинг и блендинг

# Прогресс

Дата | Время | Скор на лидерборде | Модель| Датасет  | Место
-|-|-|-|-|-
30.10.2021 | 05:00 |  0.31153846153846154 |  | | 24
30.10.2021 | 13:48 | 0.5025641025641026 | base 2| добавил chronom | 17
30.10.2021 | 15:29 | 0.5064102564102564 | base 3 | добавил plavki | 20
30.10.2021 | 18:15 | 0.5166666666666667 | base 4 | всё без gas, sip (добавил produv) | 23
30.10.2021 | 19:04 | 0.4846153846153846 | base 5 | всё без sip (добавил gas) | 
31.10.2021 | 00:21 | 0.5012820512820513 | lama wo gas | всё без gas и без sip | 
31.10.2021 | 00:39 | 0.41923076923076924 | lgbm kagle params | всё без gas и без sip| 
31.10.2021 | 00:43 | **0.49615384615384617** | **3_model.ipynb**: lgbm st params | всё без gas и без sip| 
31.10.2021 | 00:46 | **0.48717948717948717** | 2_lama_gas | всё без sip (добавил gas) | 
31.10.2021 | 05:05 | 0.48205128205128206 | xgb outlier=None | всё без gas и без sip | 		
31.10.2021 | 05:08 | 0.48205128205128206 | xgb outlier=100 | всё без gas и без sip | 
31.10.2021 | 05:57 | 0.5166666666666667 | xgb reg n_trees=15 | всё без gas и без sip | 		
31.10.2021 | 06:07 | 0.5115384615384615 | xgb reg n_trees=16 | всё без sip (добавил gas) | 
31.10.2021 | 06:48 | 0.5064102564102564 | xgb reg n_trees=16 | all feats |
31.10.2021 | 08:23 | скор на лидерборе= 0.45897435897435895, скор= **0.5371794871794872**, итоговый скор на привате= **0.4634615384615385** | xgb reg n_trees=17 | feat selection **Отправил как финальное решение** | 46 
 | | | сабмиты после окончания соревнования | | 
01.11.2021 | 20:14 | 0.5358974358974359	0.532051282051282 | лог таргета и экспонирование предсказания 6_model.ipynb | | 
01.11.2021 | 22:52 | **0.5371794871794872	0.5391025641025641** | лучший скор, 2_lama_2.ipynb LAMA стекинг ['linear_l2', 'lgb', 'cb'], ['lgb_tuned', 'cb'] | all features | занял бы 31 место